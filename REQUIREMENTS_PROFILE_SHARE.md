# プロフィール共有機能 要件定義書

## 概要
Instagramのようなプロフィール共有機能を実装します。ユーザーは自分のプロフィールURLを生成し、他のユーザーと共有できるようにします。

## 機能要件

### 1. プロフィールページのルーティング
- **URL形式**: `/profile/[username]`
- **例**: `/profile/tanaka_taro`
- Next.js App Routerの動的ルーティングを使用
- ユーザー名（username）でプロフィールを識別

### 2. プロフィールページの表示
- **公開プロフィールのみ表示可能**（`is_public = true`の場合のみ）
- 表示内容:
  - ユーザー名（username）
  - プロフィールアイコン（現在は絵文字、将来的にアップロード画像対応可）
  - 自己紹介（bio）
  - フォロー数・フォロワー数
  - フォローボタン（自分のプロフィールの場合は非表示）
  - 視聴済みアニメ一覧（公開設定に応じて）

### 3. 共有機能のUI

#### 3.1 プロフィールタブ内の共有ボタン
- 場所: プロフィールタブのユーザー名の横または上部に3点リーダー（⋮）アイコンボタンを配置
- クリックで共有メニューを表示

#### 3.2 共有メニュー
Instagramのようなモーダル形式で表示：
- **「プロフィールを共有」** オプション
- **「リンクをコピー」** オプション
- **「閉じる」** ボタン

#### 3.3 共有アクション
1. **Web Share APIを使用**（対応デバイスの場合）
   - タイトル: ユーザー名 + "のプロフィール"
   - テキスト: 自己紹介があれば表示、なければ「アニメログをチェックしよう！」
   - URL: `https://yourdomain.com/profile/{username}`

2. **フォールバック（Web Share API非対応の場合）**
   - URLをクリップボードにコピー
   - 「リンクをクリップボードにコピーしました」という通知を表示

#### 3.4 リンクをコピー機能
- プロフィールURLをクリップボードにコピー
- コピー成功時の通知を表示

### 4. プロフィールURLの生成
- プロフィールが公開されている場合のみ共有可能
- URL形式: `{現在のドメイン}/profile/{username}`
- ユーザー名が未設定の場合は共有機能を無効化（または設定を促すメッセージを表示）

### 5. エラーハンドリング
- 非公開プロフィールの場合: 共有ボタンを無効化または非表示
- ユーザー名が未設定の場合: 共有ボタンを無効化、設定を促すメッセージを表示
- 存在しないユーザー名でアクセスした場合: 404ページまたは「プロフィールが見つかりません」メッセージ

### 6. セキュリティ・プライバシー
- 公開プロフィール（`is_public = true`）のみアクセス可能
- 非公開プロフィールは本人のみアクセス可能
- RLS（Row Level Security）でデータベースレベルでも制御

## 実装項目

### フロントエンド
1. ✅ `/app/profile/[username]/page.tsx` - プロフィールページの作成
2. ✅ プロフィールタブに共有ボタン（3点リーダー）の追加
3. ✅ 共有メニューモーダルの実装
4. ✅ URLコピー機能の実装
5. ✅ Web Share APIの実装

### バックエンド
1. ✅ usernameからUserProfileを取得する関数（既存の`getPublicProfile`を拡張）
2. ✅ usernameでプロフィールを検索する関数

### UI/UX
1. ✅ Instagramライクなデザイン
2. ✅ モバイル対応
3. ✅ ダークモード対応
4. ✅ アニメーション・トランジション

## 技術仕様

### 使用技術
- Next.js App Router（動的ルーティング）
- React Hooks（useState, useEffect）
- Clipboard API
- Web Share API
- Supabase（データ取得）

### ファイル構成
```
app/
  profile/
    [username]/
      page.tsx  # プロフィールページ
app/
  page.tsx      # 既存のメインページ（共有ボタン追加）
```

## 確認事項
- [ ] プロフィールURLの形式で問題ないか（`/profile/[username]`）
- [ ] 共有メニューのデザイン・配置で問題ないか
- [ ] エラーハンドリングの方針で問題ないか
- [ ] その他希望する機能や変更点があるか

